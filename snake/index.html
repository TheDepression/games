<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Letter Quest</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    padding: 5px;
    box-sizing: border-box;
  }
  
  #gameContainer {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 10px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    border: 1px solid rgba(255, 255, 255, 0.18);
    width: 100%;
    max-width: 600px;
  }
  
  #header {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
    margin-bottom: 6px;
    align-items: center;
  }
  
  #playerInfo {
    background: rgba(255, 255, 255, 0.15);
    padding: 8px;
    border-radius: 12px;
    text-align: center;
  }
  
  #playerName {
    font-size: 12px;
    font-weight: bold;
    color: #ffd700;
    margin-bottom: 2px;
  }
  
  #highScore {
    font-size: 10px;
    opacity: 0.9;
  }
  
  #wordDisplay {
    background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
    padding: 12px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
  }
  
  #englishWord {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 4px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }
  
  #japaneseWord {
    font-size: 14px;
    opacity: 0.9;
    font-weight: 300;
  }
  
  #scoreInfo {
    background: rgba(255, 255, 255, 0.15);
    padding: 8px;
    border-radius: 12px;
    text-align: center;
  }
  
  #currentScore {
    font-size: 18px;
    font-weight: bold;
    color: #4ecdc4;
    margin-bottom: 2px;
  }
  
  #progressText {
    font-size: 10px;
    opacity: 0.8;
  }
  
  #gameArea {
    width: 100%;
    height: 350px;
    background: linear-gradient(135deg, #74b9ff, #0984e3);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 8px;
  }
  
  .letter {
    position: absolute;
    color: white;
    font-size: 20px;
    font-weight: bold;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    width: 32px;
    height: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: transform 0.2s ease;
  }
  
  .letter:hover {
    transform: scale(1.1);
  }
  
  .correct-letter {
    background: linear-gradient(45deg, #6c5ce7, #a29bfe);
    animation: glow 2s ease-in-out infinite alternate;
  }

  .wrong-letter {
    background: linear-gradient(45deg, #6c5ce7, #a29bfe);
  }
  
  @keyframes glow {
    from { box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    to { box-shadow: 0 4px 20px rgba(0, 184, 148, 0.6); }
  }
  
  .snake-segment {
    position: absolute;
    background: linear-gradient(45deg, #2ecc71, #27ae60);
    border-radius: 50%;
    transition: all 0.1s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  
  .snake-head {
    background: linear-gradient(45deg, #229954, #1e8449) !important;
    box-shadow: 0 3px 12px rgba(0,0,0,0.3);
    z-index: 10;
  }
  
  .snake-head::after {
    content: 'üëÅÔ∏è';
    position: absolute;
    font-size: 10px;
    transform: translate(-50%, -50%);
    left: 50%;
    top: 50%;
  }
  
  #turnControls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 80px;
    margin-bottom: 8px;
    padding: 0 20px;
  }
  
  .turn-button {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
    -webkit-user-select: none;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  
  .turn-button:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }
  
  .turn-button:active {
    transform: scale(0.95);
    background: rgba(255, 255, 255, 0.35);
  }
  
  #controls {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 8px;
  }
  
  button {
    background: linear-gradient(45deg, #6c5ce7, #a29bfe);
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
  }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
  }
  
  button:active {
    transform: translateY(0);
  }
  
  #countdown {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 60px;
    font-weight: bold;
    color: white;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
    display: none;
    z-index: 100;
    animation: pulse 0.5s ease-in-out;
  }
  
  @keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
  
  #nameModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  
  #nameForm {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 25px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }
  
  #nameInput {
    padding: 10px 18px;
    border: none;
    border-radius: 20px;
    font-size: 14px;
    margin: 12px 0;
    width: 180px;
    text-align: center;
    background: rgba(255, 255, 255, 0.9);
  }
  
  #leaderboard {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  
  #leaderboardContent {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 25px;
    border-radius: 20px;
    max-width: 450px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  }
  
  #leaderboardList {
    margin: 15px 0;
  }
  
  .leaderboard-entry {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    margin: 4px 0;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    backdrop-filter: blur(5px);
  }
  
  .leaderboard-entry.current-player {
    background: linear-gradient(45deg, #ffd700, #ffed4e);
    color: #333;
    font-weight: bold;
  }
  
  #gameOverMessage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(45deg, #e74c3c, #c0392b);
    padding: 25px;
    border-radius: 20px;
    font-size: 20px;
    font-weight: bold;
    color: white;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    z-index: 50;
  }
  
  /* Mobile optimizations */
  @media (max-width: 480px) {
    #gameContainer {
      padding: 8px;
      max-width: 95vw;
    }
    
    #header {
      gap: 4px;
      margin-bottom: 4px;
    }
    
    #playerInfo, #scoreInfo {
      padding: 6px;
    }
    
    #playerName {
      font-size: 10px;
    }
    
    #currentScore {
      font-size: 16px;
    }
    
    #englishWord {
      font-size: 18px;
    }
    
    #japaneseWord {
      font-size: 12px;
    }
    
    .turn-button {
      width: 50px;
      height: 50px;
      font-size: 20px;
    }
    
    #turnControls {
      height: 60px;
      padding: 0 15px;
    }
    
    .letter {
      width: 28px;
      height: 28px;
      font-size: 18px;
    }
    
    button {
      padding: 6px 12px;
      font-size: 11px;
    }
  }
</style>
</head>
<body>
<div id="gameContainer">
  <div id="header">
    <div id="playerInfo">
      <div id="playerName">Player</div>
      <div id="highScore">Best: 0</div>
    </div>
    
    <div id="wordDisplay">
      <div id="englishWord">cat</div>
      <div id="japaneseWord">„Å≠„Åìüêà</div>
    </div>
    
    <div id="scoreInfo">
      <div id="currentScore">0</div>
      <div id="progressText">Letters: 0/3</div>
    </div>
  </div>
  
  <div id="gameArea"></div>
  
  <div id="turnControls">
    <div class="turn-button" id="turnLeft">‚Ü∫</div>
    <div class="turn-button" id="turnRight">‚Üª</div>
  </div>
  
  <div id="controls">
    <button onclick="startGame()">üéÆ Start Game</button>
    <button onclick="resetGame()">üõë Stop</button>
    <button onclick="showLeaderboard()">üèÜ Leaderboard</button>
  </div>
  
  <div id="countdown">3</div>
</div>

<!-- Name Input Modal -->
<div id="nameModal">
  <div id="nameForm">
    <h2 style="margin-bottom: 20px;">üêç Welcome to Snake Letter Quest!</h2>
    <p>Enter your name to track your high scores:</p>
    <input type="text" id="nameInput" placeholder="Your name" maxlength="20">
    <br>
    <button onclick="saveName()" style="margin-top: 15px;">Start Playing! üöÄ</button>
  </div>
</div>

<!-- Leaderboard Modal -->
<div id="leaderboard">
  <div id="leaderboardContent">
    <h2 style="text-align: center; margin-bottom: 20px;">üèÜ Top 25 Players</h2>
    <div id="leaderboardList">
      <!-- Placeholder leaderboard data -->
      <div class="leaderboard-entry">
        <span>1. ü¶ç„Éú„Çπ</span>
        <span>109</span>
      </div>
      <div class="leaderboard-entry">
        <span>2. Dr.Bear</span>
        <span>62</span>
      </div>
      <div class="leaderboard-entry">
        <span>3. „ÇÑ„Åç„Åì</span>
        <span>58</span>
      </div>
      <div class="leaderboard-entry">
        <span>4. „Éê„É≥„Éî„Éº</span>
        <span>44</span>
      </div>
      <div class="leaderboard-entry">
        <span>5. „Éê„Éä„Éä„Åï„Åæ</span>
        <span>39</span>
      </div>
    </div>
    <div style="text-align: center;">
      <button onclick="hideLeaderboard()">Close</button>
    </div>
  </div>
</div>

<script>
  const gameArea = document.getElementById('gameArea');
  const englishWord = document.getElementById('englishWord');
  const japaneseWord = document.getElementById('japaneseWord');
  const currentScore = document.getElementById('currentScore');
  const progressText = document.getElementById('progressText');
  const playerName = document.getElementById('playerName');
  const highScore = document.getElementById('highScore');
  const countdownElement = document.getElementById('countdown');
  const nameModal = document.getElementById('nameModal');
  const nameInput = document.getElementById('nameInput');
  const leaderboard = document.getElementById('leaderboard');
  const turnLeftBtn = document.getElementById('turnLeft');
  const turnRightBtn = document.getElementById('turnRight');
  
// Replace the existing segmentSize and grid calculations with this:
let segmentSize, gridWidth, gridHeight;

function calculateGameDimensions() {
  const gameAreaElement = document.getElementById('gameArea');
  const actualWidth = gameAreaElement.offsetWidth;
  const actualHeight = gameAreaElement.offsetHeight;
  
  // Use the smaller dimension to ensure it fits both width and height
  const gameSize = Math.min(actualWidth, actualHeight);
  
  segmentSize = Math.floor(gameSize / 17); // 17x17 grid for clean division
  gridWidth = Math.floor(gameSize / segmentSize);
  gridHeight = Math.floor(gameSize / segmentSize);
  
  console.log(`Game area: ${actualWidth}x${actualHeight}, Grid: ${gridWidth}x${gridHeight}, Segment: ${segmentSize}`);
}

  
  // Extended word list with 30 words
  const words = [
    { jap: '„Å≠„Åìüêà', eng: 'cat' },
    { jap: '„ÅÑ„Å¨üêï', eng: 'dog' },
    { jap: '„Å∂„Åüüêñ', eng: 'pig' },
    { jap: '„É§„Ç≠„Ç≥üë∏üèª', eng: 'Yakiko' },
    { jap: '„Çä„Çì„Åîüçé', eng: 'apple' },
    { jap: '„Åï„Çãüêí', eng: 'monkey' },
    { jap: '„ÅÜ„ÅóüêÆ', eng: 'cow' },
    { jap: '„Åä„Åµ„ÇçüõÄ', eng: 'bath' },
    { jap: '„Åï„Å®„Åóüë®‚Äçüè≠', eng: 'Satoshi' },
    { jap: '„Éû„É™„Ç™ü•∏', eng: 'Mario' },
    { jap: '„Åï„Å®„Åìüë©‚Äçü¶∞', eng: 'Satoko' },
    { jap: 'Âá∫Êó•Âúüüßë‚Äçü¶≤', eng: 'David' },
    { jap: '„Å≠„Çãüí§', eng: 'sleep' },
    { jap: '„Åø„Åöüíß', eng: 'water' },
    { jap: '„Å≤üåû', eng: 'sun' },
    { jap: '„Å§„Åçüåô', eng: 'moon' },
    { jap: '„Åª„Åó‚≠ê', eng: 'star' },
    { jap: '„ÅØ„Å™üå∏', eng: 'flower' },
    { jap: '„Åçüå≥', eng: 'tree' },
    { jap: '„ÇÑ„Åæ‚õ∞Ô∏è', eng: 'mountain' },
    { jap: '„ÅÜ„Åøüåä', eng: 'ocean' },
    { jap: '„Å®„Çäüê¶', eng: 'bird' },
    { jap: '„Åï„Åã„Å™üêü', eng: 'fish' },
    { jap: '„Éë„É≥üçû', eng: 'bread' },
    { jap: '„Åé„ÇÖ„ÅÜ„Å´„ÇÖ„ÅÜü•õ', eng: 'milk' },
    { jap: '„Åè„Çã„Åæüöó', eng: 'car' },
    { jap: '„Åß„Çì„Åó„ÇÉüöä', eng: 'train' },
    { jap: '„ÅÑ„Åàüè†', eng: 'house' },
    { jap: '„Åå„Å£„Åì„ÅÜüè´', eng: 'school' },
    { jap: '„Åª„Çìüìö', eng: 'book' }
  ];
  
  let currentWord = null;
  let currentIndex = 0;
  let snake = []; // Initialize empty, will be set in resetGame
  let direction = { x: 1, y: 0 }; // Start moving right
  let score = 0;
  let gameInterval = null;
  let gameOver = false;
  let audio = new Audio();
  let countdownInterval;
  let playerData = {
    name: '',
    highScore: 0
  };
  
  // Initialize game
  window.onload = function() {
    checkPlayerName();
  };
  
  function checkPlayerName() {
    const savedData = localStorage.getItem('snakeGamePlayer');
    if (savedData) {
      playerData = JSON.parse(savedData);
      playerName.textContent = playerData.name;
      highScore.textContent = `Best: ${playerData.highScore}`;
    } else {
      nameModal.style.display = 'flex';
    }
  }
  
  function saveName() {
    const name = nameInput.value.trim();
    if (name) {
      playerData.name = name;
      playerData.highScore = 0;
      localStorage.setItem('snakeGamePlayer', JSON.stringify(playerData));
      playerName.textContent = name;
      highScore.textContent = `Best: 0`;
      nameModal.style.display = 'none';
    } else {
      alert('Please enter a valid name!');
    }
  }
  
  function startGame() {
    if (!playerData.name) {
      nameModal.style.display = 'flex';
      return;
    }
    
    resetGame();
    currentWord = words[Math.floor(Math.random() * words.length)];
    englishWord.textContent = currentWord.eng;
    japaneseWord.textContent = currentWord.jap;
    updateProgress();
    placeLetters();
    gameInterval = setInterval(moveSnake, 200);
    audio.src = 'https://raw.githubusercontent.com/TheDepression/Sounds/main/musicalchairsloop.m4a';
    audio.loop = true;
    audio.play().catch(e => console.log('Audio play failed:', e));
  }
  
  function resetGame() {
    if (gameInterval) clearInterval(gameInterval);
    if (audio) audio.pause();
    snake = [{ x: Math.floor(gridWidth/2), y: Math.floor(gridHeight/2) }];
    direction = { x: 1, y: 0 }; // Start moving right
    currentIndex = 0;
    score = 0;
    gameOver = false;
    currentScore.textContent = score;
    gameArea.innerHTML = '';
    const gameOverMessage = document.getElementById('gameOverMessage');
    if (gameOverMessage) gameOverMessage.remove();
  }
  
  function updateProgress() {
    progressText.textContent = `Letters: ${currentIndex}/${currentWord.eng.length}`;
  }
  
  function placeLetters() {
    // Clear existing letters
    gameArea.querySelectorAll('.letter').forEach(letter => letter.remove());
    
    // Render snake first
    renderSnake();
    
    // Place correct letter
    const [correctX, correctY] = generateLetterPosition();
    const correctLetter = document.createElement('div');
    correctLetter.className = 'letter correct-letter';
    correctLetter.id = 'correctLetter';
    correctLetter.textContent = currentWord.eng[currentIndex].toUpperCase();
    correctLetter.style.left = `${correctX}px`;
    correctLetter.style.top = `${correctY}px`;
    gameArea.appendChild(correctLetter);
    
    // Place wrong letter
    let distractionX, distractionY;
    let distractionLetter;
    do {
      [distractionX, distractionY] = generateLetterPosition();
      distractionLetter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
    } while (
      (Math.abs(distractionX - correctX) < 40 && Math.abs(distractionY - correctY) < 40) ||
      distractionLetter === currentWord.eng[currentIndex].toUpperCase()
    );
    
    const distractionElement = document.createElement('div');
    distractionElement.className = 'letter wrong-letter';
    distractionElement.id = 'distractionLetter';
    distractionElement.textContent = distractionLetter;
    distractionElement.style.left = `${distractionX}px`;
    distractionElement.style.top = `${distractionY}px`;
    gameArea.appendChild(distractionElement);
  }
  
function generateLetterPosition() {
  let x, y;
  let attempts = 0;
  const letterSize = 32;
  
  // Make sure we have valid grid dimensions
  if (!gridWidth || !gridHeight || !segmentSize) {
    calculateGameDimensions();
  }
  
  const maxX = Math.max(0, (gridWidth * segmentSize) - letterSize);
  const maxY = Math.max(0, (gridHeight * segmentSize) - letterSize);
  
  do {
    x = Math.floor(Math.random() * maxX);
    y = Math.floor(Math.random() * maxY);
    attempts++;
  } while (isNearSnake(x, y) && attempts < 50);
  return [x, y];
}
  
  function isNearSnake(x, y) {
    const safeDistance = 90;
    return snake.some(segment => {
      const segX = segment.x * segmentSize;
      const segY = segment.y * segmentSize;
      return Math.abs(segX - x) < safeDistance && Math.abs(segY - y) < safeDistance;
    });
  }
  
  function moveSnake() {
    if (gameOver) return;
    
    const head = { ...snake[0] };
    head.x += direction.x;
    head.y += direction.y;
    
    // Wrap around edges
    if (head.x < 0) head.x = gridWidth - 1;
    if (head.x >= gridWidth) head.x = 0;
    if (head.y < 0) head.y = gridHeight - 1;
    if (head.y >= gridHeight) head.y = 0;
    
    snake.unshift(head);
    snake.pop();
    
    checkCollision();
    renderSnake();
  }
  
  function checkCollision() {
    const head = snake[0];
    const correctLetter = document.getElementById('correctLetter');
    const distractionLetter = document.getElementById('distractionLetter');
    
    if (correctLetter && isCollision(head, correctLetter)) {
      currentIndex++;
      score += 1;
      currentScore.textContent = score;
      updateProgress();
      snake.push({ ...snake[snake.length - 1] });
      
      // Speed up at 20 points
      if (score === 20) {
        clearInterval(gameInterval);
        gameInterval = setInterval(moveSnake, 160); // 20% faster
      }
      
      if (currentIndex >= currentWord.eng.length) {
        // Word completed, get new word
        currentIndex = 0;
        currentWord = words[Math.floor(Math.random() * words.length)];
        englishWord.textContent = currentWord.eng;
        japaneseWord.textContent = currentWord.jap;
        updateProgress();
        score += 5; // Bonus for completing word
        currentScore.textContent = score;
      }
      
      onCorrectLetterEaten();
    } else if (distractionLetter && isCollision(head, distractionLetter)) {
      endGame();
    } else if (isSelfCollision(head)) {
      endGame();
    }
  }
  
  function isCollision(snakePart, letter) {
    const letterRect = letter.getBoundingClientRect();
    const gameAreaRect = gameArea.getBoundingClientRect();
    const letterX = letterRect.left - gameAreaRect.left;
    const letterY = letterRect.top - gameAreaRect.top;
    const snakeX = snakePart.x * segmentSize;
    const snakeY = snakePart.y * segmentSize;
    
    return (
      Math.abs(snakeX - letterX) < 25 &&
      Math.abs(snakeY - letterY) < 25
    );
  }
  
  function isSelfCollision(head) {
    return snake.some((segment, index) => 
      index !== 0 && head.x === segment.x && head.y === segment.y
    );
  }
  
  function renderSnake() {
    gameArea.querySelectorAll('.snake-segment').forEach(segment => segment.remove());
    
    snake.forEach((segment, index) => {
      const segmentElement = document.createElement('div');
      segmentElement.className = index === 0 ? 'snake-segment snake-head' : 'snake-segment';
      segmentElement.style.left = `${segment.x * segmentSize}px`;
      segmentElement.style.top = `${segment.y * segmentSize}px`;
      segmentElement.style.width = `${segmentSize}px`;
      segmentElement.style.height = `${segmentSize}px`;
      gameArea.appendChild(segmentElement);
    });
  }
  
function endGame() {
  gameOver = true;
  audio.pause();
  
  // Check for new high score
  if (score > playerData.highScore) {
    playerData.highScore = score;
    highScore.textContent = `Best: ${score}`;
    localStorage.setItem('snakeGamePlayer', JSON.stringify(playerData));
    
    // Update fake leaderboard
    updateFakeLeaderboard(playerData.name, score);
    
    const gameOverMessage = document.createElement('div');
    gameOverMessage.id = 'gameOverMessage';
    gameOverMessage.innerHTML = `
      <div>üéâ NEW HIGH SCORE! üéâ</div>
      <div style="font-size: 18px; margin-top: 10px;">Score: ${score}</div>
      <div style="font-size: 14px; margin-top: 10px;">Checking leaderboard...</div>
    `;
    gameArea.appendChild(gameOverMessage);
    
    setTimeout(() => {
      showLeaderboard();
    }, 2000);
  } else {
    const gameOverMessage = document.createElement('div');
    gameOverMessage.id = 'gameOverMessage';
    gameOverMessage.innerHTML = `
      <div>Game Over</div>
      <div style="font-size: 18px; margin-top: 10px;">Score: ${score}</div>
      <div style="font-size: 14px; margin-top: 10px;">Best: ${playerData.highScore}</div>
    `;
    gameArea.appendChild(gameOverMessage);
  }
}

function updateFakeLeaderboard(playerName, playerScore) {
  const leaderboardList = document.getElementById('leaderboardList');
  
  // Get existing entries
  const entries = [
    { name: 'ü¶ç„Éú„Çπ', score: 109 },
    { name: 'Dr.Bear', score: 62 },
    { name: '„ÇÑ„Åç„Åì', score: 58 },
    { name: '„Éê„É≥„Éî„Éº', score: 44 },
    { name: '„Éê„Éä„Éä„Åï„Åæ', score: 39 }
  ];
  
  // Add player's score
  entries.push({ name: playerName, score: playerScore });
  
  // Sort by score (highest first)
  entries.sort((a, b) => b.score - a.score);
  
  // Keep only top 10
  entries.splice(10);
  
  // Rebuild leaderboard HTML
  leaderboardList.innerHTML = '';
  entries.forEach((entry, index) => {
    const entryDiv = document.createElement('div');
    entryDiv.className = 'leaderboard-entry';
    if (entry.name === playerName) {
      entryDiv.classList.add('current-player');
    }
    entryDiv.innerHTML = `
      <span>${index + 1}. ${entry.name}</span>
      <span>${entry.score}</span>
    `;
    leaderboardList.appendChild(entryDiv);
  });
}
  
  function submitToLeaderboard(name, score) {
    // TODO: Implement Supabase integration
    console.log(`Submitting to leaderboard: ${name} - ${score}`);
    // This would be your Supabase API call
  }
  
  function showLeaderboard() {
    // TODO: Fetch real data from Supabase
    leaderboard.style.display = 'flex';
  }
  
  function hideLeaderboard() {
    leaderboard.style.display = 'none';
  }
  
  function onCorrectLetterEaten() {
    pauseGame();
    placeLetters();
    startCountdown();
  }
  
  function startCountdown() {
    let counter = 3;
    countdownElement.style.display = 'block';
    countdownElement.textContent = counter;
    countdownInterval = setInterval(() => {
      counter--;
      if (counter > 0) {
        countdownElement.textContent = counter;
      } else {
        clearInterval(countdownInterval);
        countdownElement.style.display = 'none';
        resumeGame();
      }
    }, 300);
  }
  
  function pauseGame() {
    clearInterval(gameInterval);
  }
  
  function resumeGame() {
    const speed = score >= 20 ? 160 : 200;
    gameInterval = setInterval(moveSnake, speed);
  }
  
  // Turn controls - the new left/right turn system
  function turnLeft() {
    // Rotate direction 90 degrees counterclockwise
    const newDirection = { x: direction.y, y: -direction.x };
    direction = newDirection;
  }
  
  function turnRight() {
    // Rotate direction 90 degrees clockwise
    const newDirection = { x: -direction.y, y: direction.x };
    direction = newDirection;
  }
  
  // Touch/click event listeners for turn buttons
  turnLeftBtn.addEventListener('touchstart', function(e) {
    e.preventDefault();
    turnLeft();
  });
  
  turnLeftBtn.addEventListener('click', function(e) {
    e.preventDefault();
    turnLeft();
  });
  
  turnRightBtn.addEventListener('touchstart', function(e) {
    e.preventDefault();
    turnRight();
  });
  
  turnRightBtn.addEventListener('click', function(e) {
    e.preventDefault();
    turnRight();
  });
  
  // Keyboard controls (still available for desktop)
  document.addEventListener('keydown', function(event) {
    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
      event.preventDefault();
    }
    
    // Left and Right arrows for turning
    if (event.key === 'ArrowLeft') {
      turnLeft();
    } else if (event.key === 'ArrowRight') {
      turnRight();
    }
    
    // Original directional controls still work
    if (event.key === 'ArrowUp' && direction.y === 0) {
      direction = { x: 0, y: -1 };
    } else if (event.key === 'ArrowDown' && direction.y === 0) {
      direction = { x: 0, y: 1 };
    } else if (event.key === 'ArrowLeft' && direction.x === 0) {
      direction = { x: -1, y: 0 };
    } else if (event.key === 'ArrowRight' && direction.x === 0) {
      direction = { x: 1, y: 0 };
    }
  });
</script>
</body>
</html>
